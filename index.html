<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<title>Chat Bot dengan Audio</title>
<link href='https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css' rel='stylesheet'>
<style>
    *{margin:0;padding:0;box-sizing:border-box;}
    body{font-family:'Roboto',sans-serif;display:flex;flex-direction:column;height:100vh;background:#1a2332;color:white;}

    /* ===== HEADER MODERN ===== */
    .chat-header{
        background:#2c3e50;
        padding:12px;
        display:flex;
        align-items:center;
        gap:12px;
        border-bottom:2px solid #34495e;
        box-shadow:0 2px 6px rgba(0,0,0,0.3);
    }
    .chat-header .profile-wrapper{
        width:48px;
        height:48px;
        border-radius:50%;
        background:linear-gradient(135deg,#5a6c7d,#6ba5cf);
        display:flex;
        align-items:center;
        justify-content:center;
        border:2px solid rgba(107,165,207,0.4);
    }
    .chat-header .profile-wrapper img{
        width:40px;
        height:40px;
        border-radius:50%;
    }
    .chat-header .info{
        flex:1;
    }
    .chat-header .info .name{
        font-size:18px;
        font-weight:600;
        color:white;
    }
    .chat-header .info .status{
        font-size:12px;
        color:#8fa5b8;
    }
    .chat-header .actions i{
        font-size:22px;
        color:white;
        margin-left:12px;
        cursor:pointer;
    }

    .messages-area{flex:1;overflow-y:auto;padding:12px;display:flex;flex-direction:column;gap:10px;}

    .message{max-width:75%;padding:8px;border-radius:12px;word-wrap:break-word;position:relative;font-size:15px;}
    .message-sent{align-self:flex-end;background:#3d9db5;}
    .message-received{align-self:flex-start;background:#2c3e50;}

    .message-time{font-size:10px;color:rgba(255,255,255,0.6);text-align:right;margin-top:4px;}

    .input-area{display:flex;align-items:center;padding:10px;background:#2c3e50;gap:10px;}

    #messageInput{
        flex:1;
        padding:12px 16px;
        border:none;
        border-radius:24px;
        background:#34495e;
        color:white;
        font-size:15px;
    }
    #messageInput:focus {
        background: #3d5368;
        outline: none;
        box-shadow: none;
        border: none;
    }

    .send-button{
        width:48px;height:48px;
        background:#3d9db5;
        border:none;border-radius:50%;
        color:white;
        display:flex;align-items:center;justify-content:center;font-size:24px;cursor:pointer;
    }
</style>
</head>
<body>

<div class="chat-header">
    <div class="profile-wrapper">
        <img src="https://cdn-icons-png.flaticon.com/512/4712/4712027.png" alt="Bot Profile">
    </div>
    <div class="info">
        <div class="name">AI Assistant</div>
        <div class="status">Online</div>
    </div>
    <div class="actions">
        <i class='bx bx-phone'></i>
        <i class='bx bx-video'></i>
        <i class='bx bx-dots-vertical-rounded'></i>
    </div>
</div>

<div class="messages-area" id="messagesArea"></div>

<div class="input-area">
    <input type="text" id="messageInput" placeholder="Ketik pesan..." oninput="toggleInputIcon()" onkeypress="if(event.key==='Enter') sendTextMessage()">
    <button class="send-button" id="sendButton">
        <i class='bx bx-microphone' id="buttonIcon"></i>
    </button>
</div>

<script>
const OPENROUTER_KEY = "ISI_APIKEY_KAMU_DISINI";
const OPENROUTER_URL = "https://openrouter.ai/api/v1/chat/completions";

/* ==== RECORD AUDIO ==== */
let isRecording=false, mediaRecorder=null, audioChunks=[];
const sendBtn = document.getElementById('sendButton');
const buttonIcon = document.getElementById('buttonIcon');
const inputField = document.getElementById('messageInput');

sendBtn.addEventListener('mousedown', startPress);
sendBtn.addEventListener('mouseup', endPress);
sendBtn.addEventListener('touchstart', startPress, {passive:false});
sendBtn.addEventListener('touchend', endPress, {passive:false});

function toggleInputIcon(){
    if(inputField.value.trim().length>0){
        buttonIcon.className='bx bx-send';
    } else {
        buttonIcon.className='bx bx-microphone';
    }
}

function startPress(e){
    e.preventDefault();
    if(inputField.value.trim().length>0) return; 
    isRecording=false;
    this.longPressTimer = setTimeout(()=>{
        isRecording=true;
        beginRecording();
    },400);
}

function endPress(e){
    e.preventDefault();
    clearTimeout(this.longPressTimer);
    if(inputField.value.trim().length>0){
        sendTextMessage();
        return;
    }
    if(isRecording){
        stopRecording();
    }
}

async function beginRecording(){
    try{
        const stream=await navigator.mediaDevices.getUserMedia({audio:true});
        mediaRecorder = new MediaRecorder(stream);
        audioChunks=[];
        mediaRecorder.ondataavailable=ev=>audioChunks.push(ev.data);
        mediaRecorder.start();
        buttonIcon.className='bx bx-stop';
    } catch(err){
        console.error("Mic error:",err);
    }
}

function stopRecording(){
    mediaRecorder.stop();
    mediaRecorder.onstop = ()=>{
        const blob=new Blob(audioChunks,{type:'audio/webm'});
        const url=URL.createObjectURL(blob);
        appendAudioMessage(url);
    };
    buttonIcon.className='bx bx-microphone';
}

function appendMessage(txt, type){
    const area=document.getElementById('messagesArea');
    const div=document.createElement('div');
    div.className='message '+(type==='sent'?'message-sent':'message-received');
    div.innerHTML=`<div>${txt}</div><div class="message-time">${new Date().getHours().toString().padStart(2,'0')}:${new Date().getMinutes().toString().padStart(2,'0')}</div>`;
    area.appendChild(div);
    area.scrollTop=area.scrollHeight;
}

function appendAudioMessage(url){
    const area=document.getElementById('messagesArea');
    const div=document.createElement('div');
    div.className='message message-sent';
    div.innerHTML=`
        <audio controls src="${url}"></audio>
        <div class="message-time">${new Date().getHours().toString().padStart(2,'0')}:${new Date().getMinutes().toString().padStart(2,'0')}</div>`;
    area.appendChild(div);
    area.scrollTop=area.scrollHeight;
}

async function botReply(text){
    try{
        const payload={model:"qwen3-max",messages:[{role:"user",content:text}]};
        const res=await fetch(OPENROUTER_URL,{
            method:"POST",
            headers:{"Content-Type":"application/json","Authorization":`Bearer ${OPENROUTER_KEY}`},
            body:JSON.stringify(payload)
        });
        const data=await res.json();
        return data.choices?.[0]?.message?.content || "Bot tidak membalas.";
    } catch(err){
        console.error("Bot error",err);
        return "Gagal terhubung ke bot.";
    }
}

async function sendTextMessage(){
    const text = inputField.value.trim();
    if(!text) return;
    appendMessage(text,'sent');
    inputField.value="";
    toggleInputIcon();
    const reply = await botReply(text);
    appendMessage(reply,'received');
}
</script>

</body>
</html>